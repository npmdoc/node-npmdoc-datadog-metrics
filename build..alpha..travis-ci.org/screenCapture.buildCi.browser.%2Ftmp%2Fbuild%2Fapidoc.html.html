<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/dbader/node-datadog-metrics#readme">datadog-metrics (v0.4.0)</a>
</h1>
<h4>Buffered metrics reporting via the DataDog HTTP API</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.datadog-metrics">module datadog-metrics</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.datadog-metrics.BufferedMetricsLogger">
            function <span class="apidocSignatureSpan">datadog-metrics.</span>BufferedMetricsLogger
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.datadog-metrics.flush">
            function <span class="apidocSignatureSpan">datadog-metrics.</span>flush
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.datadog-metrics.gauge">
            function <span class="apidocSignatureSpan">datadog-metrics.</span>gauge
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.datadog-metrics.histogram">
            function <span class="apidocSignatureSpan">datadog-metrics.</span>histogram
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.datadog-metrics.increment">
            function <span class="apidocSignatureSpan">datadog-metrics.</span>increment
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.datadog-metrics.init">
            function <span class="apidocSignatureSpan">datadog-metrics.</span>init
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">datadog-metrics.</span>BufferedMetricsLogger.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">datadog-metrics.</span>aggregators</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">datadog-metrics.</span>loggers</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">datadog-metrics.</span>metrics</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">datadog-metrics.</span>reporters</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.datadog-metrics.BufferedMetricsLogger">module datadog-metrics.BufferedMetricsLogger</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.datadog-metrics.BufferedMetricsLogger.BufferedMetricsLogger">
            function <span class="apidocSignatureSpan">datadog-metrics.</span>BufferedMetricsLogger
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.datadog-metrics.BufferedMetricsLogger.prototype">module datadog-metrics.BufferedMetricsLogger.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.datadog-metrics.BufferedMetricsLogger.prototype.addPoint">
            function <span class="apidocSignatureSpan">datadog-metrics.BufferedMetricsLogger.prototype.</span>addPoint
            <span class="apidocSignatureSpan">(Type, key, value, tags)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.datadog-metrics.BufferedMetricsLogger.prototype.flush">
            function <span class="apidocSignatureSpan">datadog-metrics.BufferedMetricsLogger.prototype.</span>flush
            <span class="apidocSignatureSpan">(onSuccess, onError)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.datadog-metrics.BufferedMetricsLogger.prototype.gauge">
            function <span class="apidocSignatureSpan">datadog-metrics.BufferedMetricsLogger.prototype.</span>gauge
            <span class="apidocSignatureSpan">(key, value, tags)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.datadog-metrics.BufferedMetricsLogger.prototype.histogram">
            function <span class="apidocSignatureSpan">datadog-metrics.BufferedMetricsLogger.prototype.</span>histogram
            <span class="apidocSignatureSpan">(key, value, tags)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.datadog-metrics.BufferedMetricsLogger.prototype.increment">
            function <span class="apidocSignatureSpan">datadog-metrics.BufferedMetricsLogger.prototype.</span>increment
            <span class="apidocSignatureSpan">(key, value, tags)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.datadog-metrics.aggregators">module datadog-metrics.aggregators</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.datadog-metrics.aggregators.Aggregator">
            function <span class="apidocSignatureSpan">datadog-metrics.aggregators.</span>Aggregator
            <span class="apidocSignatureSpan">(defaultTags)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.datadog-metrics.loggers">module datadog-metrics.loggers</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.datadog-metrics.loggers.BufferedMetricsLogger">
            function <span class="apidocSignatureSpan">datadog-metrics.loggers.</span>BufferedMetricsLogger
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.datadog-metrics.metrics">module datadog-metrics.metrics</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.datadog-metrics.metrics.Counter">
            function <span class="apidocSignatureSpan">datadog-metrics.metrics.</span>Counter
            <span class="apidocSignatureSpan">(key, tags, host)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.datadog-metrics.metrics.Gauge">
            function <span class="apidocSignatureSpan">datadog-metrics.metrics.</span>Gauge
            <span class="apidocSignatureSpan">(key, tags, host)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.datadog-metrics.metrics.Histogram">
            function <span class="apidocSignatureSpan">datadog-metrics.metrics.</span>Histogram
            <span class="apidocSignatureSpan">(key, tags, host)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.datadog-metrics.metrics.Metric">
            function <span class="apidocSignatureSpan">datadog-metrics.metrics.</span>Metric
            <span class="apidocSignatureSpan">(key, tags, host)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.datadog-metrics.reporters">module datadog-metrics.reporters</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.datadog-metrics.reporters.DataDogReporter">
            function <span class="apidocSignatureSpan">datadog-metrics.reporters.</span>DataDogReporter
            <span class="apidocSignatureSpan">(apiKey, appKey)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.datadog-metrics.reporters.NullReporter">
            function <span class="apidocSignatureSpan">datadog-metrics.reporters.</span>NullReporter
            <span class="apidocSignatureSpan">(apiKey, appKey)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.datadog-metrics" id="apidoc.module.datadog-metrics">module datadog-metrics</a></h1>


    <h2>
        <a href="#apidoc.element.datadog-metrics.BufferedMetricsLogger" id="apidoc.element.datadog-metrics.BufferedMetricsLogger">
        function <span class="apidocSignatureSpan">datadog-metrics.</span>BufferedMetricsLogger
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function BufferedMetricsLogger(opts) {
    this.aggregator = opts.aggregator || new Aggregator(opts.defaultTags);
    this.reporter = opts.reporter || new DataDogReporter(opts.apiKey, opts.appKey);
    this.host = opts.host;
    this.prefix = opts.prefix || '';
    this.flushIntervalSeconds = opts.flushIntervalSeconds;

    if (this.flushIntervalSeconds) {
        debug('Auto-flushing every %d seconds', this.flushIntervalSeconds);
    } else {
        debug('Auto-flushing is disabled');
    }

    var self = this;
    var autoFlushCallback = function() {
        self.flush();
        if (self.flushIntervalSeconds) {
            var interval = self.flushIntervalSeconds * 1000;
            var tid = setTimeout(autoFlushCallback, interval);
            // Let the event loop exit if this is the only active timer.
            tid.unref();
        }
    };

    autoFlushCallback();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
//
//     - aggregator: an Aggregator instance
//     - reporter: a Reporter instance
//
function init(opts) {
opts = opts || {};
opts.flushIntervalSeconds = opts.flushIntervalSeconds || 15;
sharedLogger = new loggers.<span class="apidocCodeKeywordSpan">BufferedMetricsLogger</span>(opts);
}

// This is meant to be curried via bind() so we don't have
// to write wrappers for each metric individually.
function callOnSharedLogger(funcName) {
if (sharedLogger === null) {
    init();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.datadog-metrics.flush" id="apidoc.element.datadog-metrics.flush">
        function <span class="apidocSignatureSpan">datadog-metrics.</span>flush
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">flush = function () { [native code] }</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```js
metrics.histogram('test.service_time', 0.248);
```

### Flushing

`metrics.<span class="apidocCodeKeywordSpan">flush</span>([onSuccess[, onError]])`

Calling `flush` sends any buffered metrics to DataDog. Unless you set
`flushIntervalSeconds` to 0 it won't be necessary to call this function.

It can be useful to trigger a manual flush by calling if you want to
make sure pending metrics have been sent before you quit the application
process, for example.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.datadog-metrics.gauge" id="apidoc.element.datadog-metrics.gauge">
        function <span class="apidocSignatureSpan">datadog-metrics.</span>gauge
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">gauge = function () { [native code] }</pre></li>
    <li>example usage<pre class="apidocCodePre">...
Save the following into a file named `example_app.js`:
```js
var metrics = require('datadog-metrics');
metrics.init({ host: 'myhost', prefix: 'myapp.' });

function collectMemoryStats() {
    var memUsage = process.memoryUsage();
    metrics.<span class="apidocCodeKeywordSpan">gauge</span>('memory.rss', memUsage.rss);
    metrics.gauge('memory.heapTotal', memUsage.heapTotal);
    metrics.gauge('memory.heapUsed', memUsage.heapUsed);
};

setInterval(collectMemoryStats, 5000);
```
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.datadog-metrics.histogram" id="apidoc.element.datadog-metrics.histogram">
        function <span class="apidocSignatureSpan">datadog-metrics.</span>histogram
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">histogram = function () { [native code] }</pre></li>
    <li>example usage<pre class="apidocCodePre">...
```js
metrics.increment('test.requests_served');
metrics.increment('test.awesomeness_factor', 10);
```

### Histograms

`metrics.<span class="apidocCodeKeywordSpan">histogram</span>(key, value[, tags])`

Sample a histogram value. Histograms will produce metrics that
describe the distribution of the recorded values, namely the minimum,
maximum, average, count and the 75th, 85th, 95th and 99th percentiles.
Optionally, specify a list of *tags* to associate with the metric.

Example:
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.datadog-metrics.increment" id="apidoc.element.datadog-metrics.increment">
        function <span class="apidocSignatureSpan">datadog-metrics.</span>increment
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">increment = function () { [native code] }</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```js
metrics.gauge('test.mem_free', 23);
```

### Counters

`metrics.<span class="apidocCodeKeywordSpan">increment</span>(key[, value[, tags]])`

Increment the counter by the given *value* (or `1` by default). Optionally,
specify a list of *tags* to associate with the metric. This is useful for
counting things such as incrementing a counter each time a page is requested.

Example:
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.datadog-metrics.init" id="apidoc.element.datadog-metrics.init">
        function <span class="apidocSignatureSpan">datadog-metrics.</span>init
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function init(opts) {
    opts = opts || {};
    opts.flushIntervalSeconds = opts.flushIntervalSeconds || 15;
    sharedLogger = new loggers.BufferedMetricsLogger(opts);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
## Example

![](header.png)

Save the following into a file named `example_app.js`:
```js
var metrics = require('datadog-metrics');
metrics.<span class="apidocCodeKeywordSpan">init</span>({ host: 'myhost', prefix: 'myapp.' });

function collectMemoryStats() {
    var memUsage = process.memoryUsage();
    metrics.gauge('memory.rss', memUsage.rss);
    metrics.gauge('memory.heapTotal', memUsage.heapTotal);
    metrics.gauge('memory.heapUsed', memUsage.heapUsed);
};
...</pre></li>
    </ul>












</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.datadog-metrics.BufferedMetricsLogger" id="apidoc.module.datadog-metrics.BufferedMetricsLogger">module datadog-metrics.BufferedMetricsLogger</a></h1>


    <h2>
        <a href="#apidoc.element.datadog-metrics.BufferedMetricsLogger.BufferedMetricsLogger" id="apidoc.element.datadog-metrics.BufferedMetricsLogger.BufferedMetricsLogger">
        function <span class="apidocSignatureSpan">datadog-metrics.</span>BufferedMetricsLogger
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function BufferedMetricsLogger(opts) {
    this.aggregator = opts.aggregator || new Aggregator(opts.defaultTags);
    this.reporter = opts.reporter || new DataDogReporter(opts.apiKey, opts.appKey);
    this.host = opts.host;
    this.prefix = opts.prefix || '';
    this.flushIntervalSeconds = opts.flushIntervalSeconds;

    if (this.flushIntervalSeconds) {
        debug('Auto-flushing every %d seconds', this.flushIntervalSeconds);
    } else {
        debug('Auto-flushing is disabled');
    }

    var self = this;
    var autoFlushCallback = function() {
        self.flush();
        if (self.flushIntervalSeconds) {
            var interval = self.flushIntervalSeconds * 1000;
            var tid = setTimeout(autoFlushCallback, interval);
            // Let the event loop exit if this is the only active timer.
            tid.unref();
        }
    };

    autoFlushCallback();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
//
//     - aggregator: an Aggregator instance
//     - reporter: a Reporter instance
//
function init(opts) {
opts = opts || {};
opts.flushIntervalSeconds = opts.flushIntervalSeconds || 15;
sharedLogger = new loggers.<span class="apidocCodeKeywordSpan">BufferedMetricsLogger</span>(opts);
}

// This is meant to be curried via bind() so we don't have
// to write wrappers for each metric individually.
function callOnSharedLogger(funcName) {
if (sharedLogger === null) {
    init();
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.datadog-metrics.BufferedMetricsLogger.prototype" id="apidoc.module.datadog-metrics.BufferedMetricsLogger.prototype">module datadog-metrics.BufferedMetricsLogger.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.datadog-metrics.BufferedMetricsLogger.prototype.addPoint" id="apidoc.element.datadog-metrics.BufferedMetricsLogger.prototype.addPoint">
        function <span class="apidocSignatureSpan">datadog-metrics.BufferedMetricsLogger.prototype.</span>addPoint
        <span class="apidocSignatureSpan">(Type, key, value, tags)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">addPoint = function (Type, key, value, tags) {
    this.aggregator.addPoint(Type, this.prefix + key, value, tags, this.host);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Aggregator.prototype.addPoint = function(Type, key, value, tags, host) {
var bufferKey = this.makeBufferKey(key, tags);
if (!this.buffer.hasOwnProperty(bufferKey)) {
    this.buffer[bufferKey] = new Type(key, tags, host);
}

this.buffer[bufferKey].<span class="apidocCodeKeywordSpan">addPoint</span>(value);
};

Aggregator.prototype.flush = function() {
var series = [];
for (var key in this.buffer) {
    if (this.buffer.hasOwnProperty(key)) {
        series = series.concat(this.buffer[key].flush());
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.datadog-metrics.BufferedMetricsLogger.prototype.flush" id="apidoc.element.datadog-metrics.BufferedMetricsLogger.prototype.flush">
        function <span class="apidocSignatureSpan">datadog-metrics.BufferedMetricsLogger.prototype.</span>flush
        <span class="apidocSignatureSpan">(onSuccess, onError)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">flush = function (onSuccess, onError) {
    var series = this.aggregator.flush();
    if (series.length &gt; 0) {
        debug('Flushing %d metrics to DataDog', series.length);
        this.reporter.report(series, onSuccess, onError);
    } else {
        debug('Nothing to flush');
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```js
metrics.histogram('test.service_time', 0.248);
```

### Flushing

`metrics.<span class="apidocCodeKeywordSpan">flush</span>([onSuccess[, onError]])`

Calling `flush` sends any buffered metrics to DataDog. Unless you set
`flushIntervalSeconds` to 0 it won't be necessary to call this function.

It can be useful to trigger a manual flush by calling if you want to
make sure pending metrics have been sent before you quit the application
process, for example.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.datadog-metrics.BufferedMetricsLogger.prototype.gauge" id="apidoc.element.datadog-metrics.BufferedMetricsLogger.prototype.gauge">
        function <span class="apidocSignatureSpan">datadog-metrics.BufferedMetricsLogger.prototype.</span>gauge
        <span class="apidocSignatureSpan">(key, value, tags)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">gauge = function (key, value, tags) {
    this.addPoint(Gauge, key, value, tags);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
Save the following into a file named `example_app.js`:
```js
var metrics = require('datadog-metrics');
metrics.init({ host: 'myhost', prefix: 'myapp.' });

function collectMemoryStats() {
    var memUsage = process.memoryUsage();
    metrics.<span class="apidocCodeKeywordSpan">gauge</span>('memory.rss', memUsage.rss);
    metrics.gauge('memory.heapTotal', memUsage.heapTotal);
    metrics.gauge('memory.heapUsed', memUsage.heapUsed);
};

setInterval(collectMemoryStats, 5000);
```
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.datadog-metrics.BufferedMetricsLogger.prototype.histogram" id="apidoc.element.datadog-metrics.BufferedMetricsLogger.prototype.histogram">
        function <span class="apidocSignatureSpan">datadog-metrics.BufferedMetricsLogger.prototype.</span>histogram
        <span class="apidocSignatureSpan">(key, value, tags)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">histogram = function (key, value, tags) {
    this.addPoint(Histogram, key, value, tags);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
```js
metrics.increment('test.requests_served');
metrics.increment('test.awesomeness_factor', 10);
```

### Histograms

`metrics.<span class="apidocCodeKeywordSpan">histogram</span>(key, value[, tags])`

Sample a histogram value. Histograms will produce metrics that
describe the distribution of the recorded values, namely the minimum,
maximum, average, count and the 75th, 85th, 95th and 99th percentiles.
Optionally, specify a list of *tags* to associate with the metric.

Example:
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.datadog-metrics.BufferedMetricsLogger.prototype.increment" id="apidoc.element.datadog-metrics.BufferedMetricsLogger.prototype.increment">
        function <span class="apidocSignatureSpan">datadog-metrics.BufferedMetricsLogger.prototype.</span>increment
        <span class="apidocSignatureSpan">(key, value, tags)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">increment = function (key, value, tags) {
    this.addPoint(Counter, key, value || 1, tags);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```js
metrics.gauge('test.mem_free', 23);
```

### Counters

`metrics.<span class="apidocCodeKeywordSpan">increment</span>(key[, value[, tags]])`

Increment the counter by the given *value* (or `1` by default). Optionally,
specify a list of *tags* to associate with the metric. This is useful for
counting things such as incrementing a counter each time a page is requested.

Example:
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.datadog-metrics.aggregators" id="apidoc.module.datadog-metrics.aggregators">module datadog-metrics.aggregators</a></h1>


    <h2>
        <a href="#apidoc.element.datadog-metrics.aggregators.Aggregator" id="apidoc.element.datadog-metrics.aggregators.Aggregator">
        function <span class="apidocSignatureSpan">datadog-metrics.aggregators.</span>Aggregator
        <span class="apidocSignatureSpan">(defaultTags)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Aggregator(defaultTags) {
    this.buffer = {};
    this.defaultTags = defaultTags || [];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var should = chai.should();

var aggregators = require('../lib/aggregators');
var metrics = require('../lib/metrics');

describe('Aggregator', function() {
it('should flush correctly when empty', function() {
    var agg = new aggregators.<span class="apidocCodeKeywordSpan">Aggregator</span>();
    agg.flush().should.have.length(0);
});

it('should flush a single metric correctly', function() {
    var agg = new aggregators.Aggregator();
    agg.addPoint(metrics.Gauge, 'mykey', 23, ['mytag'], 'myhost');
    agg.flush().should.have.length(1);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.datadog-metrics.loggers" id="apidoc.module.datadog-metrics.loggers">module datadog-metrics.loggers</a></h1>


    <h2>
        <a href="#apidoc.element.datadog-metrics.loggers.BufferedMetricsLogger" id="apidoc.element.datadog-metrics.loggers.BufferedMetricsLogger">
        function <span class="apidocSignatureSpan">datadog-metrics.loggers.</span>BufferedMetricsLogger
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function BufferedMetricsLogger(opts) {
    this.aggregator = opts.aggregator || new Aggregator(opts.defaultTags);
    this.reporter = opts.reporter || new DataDogReporter(opts.apiKey, opts.appKey);
    this.host = opts.host;
    this.prefix = opts.prefix || '';
    this.flushIntervalSeconds = opts.flushIntervalSeconds;

    if (this.flushIntervalSeconds) {
        debug('Auto-flushing every %d seconds', this.flushIntervalSeconds);
    } else {
        debug('Auto-flushing is disabled');
    }

    var self = this;
    var autoFlushCallback = function() {
        self.flush();
        if (self.flushIntervalSeconds) {
            var interval = self.flushIntervalSeconds * 1000;
            var tid = setTimeout(autoFlushCallback, interval);
            // Let the event loop exit if this is the only active timer.
            tid.unref();
        }
    };

    autoFlushCallback();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
//
//     - aggregator: an Aggregator instance
//     - reporter: a Reporter instance
//
function init(opts) {
opts = opts || {};
opts.flushIntervalSeconds = opts.flushIntervalSeconds || 15;
sharedLogger = new loggers.<span class="apidocCodeKeywordSpan">BufferedMetricsLogger</span>(opts);
}

// This is meant to be curried via bind() so we don't have
// to write wrappers for each metric individually.
function callOnSharedLogger(funcName) {
if (sharedLogger === null) {
    init();
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.datadog-metrics.metrics" id="apidoc.module.datadog-metrics.metrics">module datadog-metrics.metrics</a></h1>


    <h2>
        <a href="#apidoc.element.datadog-metrics.metrics.Counter" id="apidoc.element.datadog-metrics.metrics.Counter">
        function <span class="apidocSignatureSpan">datadog-metrics.metrics.</span>Counter
        <span class="apidocSignatureSpan">(key, tags, host)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Counter(key, tags, host) {
    Metric.call(this, key, tags, host);
    this.value = 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    f[0].should.have.deep.property('points[0][0]', g.timestamp);
    f[0].should.have.deep.property('points[0][1]', 1);
});
});

describe('Counter', function() {
it('should extend Metric', function() {
    var g = new metrics.<span class="apidocCodeKeywordSpan">Counter</span>();
    g.updateTimestamp.should.be.a('function');
});

it('should flush correctly', function() {
    var g = new metrics.Counter('the.key', ['mytag'], 'myhost');
    g.addPoint(1);
    var f = g.flush();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.datadog-metrics.metrics.Gauge" id="apidoc.element.datadog-metrics.metrics.Gauge">
        function <span class="apidocSignatureSpan">datadog-metrics.metrics.</span>Gauge
        <span class="apidocSignatureSpan">(key, tags, host)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Gauge(key, tags, host) {
    Metric.call(this, key, tags, host);
    this.value = 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    m.updateTimestamp(123);
    m.timestamp.should.be.a('number');
});
});

describe('Gauge', function() {
it('should extend Metric', function() {
    var g = new metrics.<span class="apidocCodeKeywordSpan">Gauge</span>();
    g.updateTimestamp.should.be.a('function');
});

it('should flush correctly', function() {
    var g = new metrics.Gauge('the.key', ['mytag'], 'myhost');
    g.addPoint(1);
    var f = g.flush();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.datadog-metrics.metrics.Histogram" id="apidoc.element.datadog-metrics.metrics.Histogram">
        function <span class="apidocSignatureSpan">datadog-metrics.metrics.</span>Histogram
        <span class="apidocSignatureSpan">(key, tags, host)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Histogram(key, tags, host) {
    Metric.call(this, key, tags, host);
    this.min = Infinity;
    this.max = -Infinity;
    this.sum = 0;
    this.count = 0;
    this.samples = [];
    this.percentiles = [0.75, 0.85, 0.95, 0.99];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    f[0].should.have.deep.property('points[0][0]', g.timestamp);
    f[0].should.have.deep.property('points[0][1]', 1);
});
});

describe('Histogram', function() {
it('should extend Metric', function() {
    var h = new metrics.<span class="apidocCodeKeywordSpan">Histogram</span>();
    h.updateTimestamp.should.be.a('function');
});

it('should report the min and max of all values', function() {
    var h = new metrics.Histogram('hist');
    var f = h.flush();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.datadog-metrics.metrics.Metric" id="apidoc.element.datadog-metrics.metrics.Metric">
        function <span class="apidocSignatureSpan">datadog-metrics.metrics.</span>Metric
        <span class="apidocSignatureSpan">(key, tags, host)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Metric(key, tags, host) {
    this.key = key;
    this.tags = tags || [];
    this.host = host || '';
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var should = chai.should();

var metrics = require('../lib/metrics');

describe('Metric', function() {
it('should set its initial state correctly', function() {
    var m = new metrics.<span class="apidocCodeKeywordSpan">Metric</span>('the.key', ['tag1'], 'myhost&amp;#
x27;);
    m.key.should.equal('the.key');
    m.tags.should.deep.equal(['tag1']);
    m.host.should.equal('myhost');
});

it('should update the timestamp when a data point is added', function() {
    var m = new metrics.Metric();
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.datadog-metrics.reporters" id="apidoc.module.datadog-metrics.reporters">module datadog-metrics.reporters</a></h1>


    <h2>
        <a href="#apidoc.element.datadog-metrics.reporters.DataDogReporter" id="apidoc.element.datadog-metrics.reporters.DataDogReporter">
        function <span class="apidocSignatureSpan">datadog-metrics.reporters.</span>DataDogReporter
        <span class="apidocSignatureSpan">(apiKey, appKey)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function DataDogReporter(apiKey, appKey) {
    apiKey = apiKey || process.env.DATADOG_API_KEY;
    appKey = appKey || process.env.DATADOG_APP_KEY;

    if (!apiKey) {
        throw new Error('DATADOG_API_KEY environment variable not set');
    }

    // jscs:disable requireCamelCaseOrUpperCaseIdentifiers
    dogapi.initialize({api_key: apiKey, app_key: appKey});
    // jscs:enable requireCamelCaseOrUpperCaseIdentifiers
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.datadog-metrics.reporters.NullReporter" id="apidoc.element.datadog-metrics.reporters.NullReporter">
        function <span class="apidocSignatureSpan">datadog-metrics.reporters.</span>NullReporter
        <span class="apidocSignatureSpan">(apiKey, appKey)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function NullReporter(apiKey, appKey) {

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var loggers = require('../lib/loggers');
var reporters = require('../lib/reporters');
var BufferedMetricsLogger = loggers.BufferedMetricsLogger;

describe('BufferedMetricsLogger', function() {
it('should have a gauge() metric', function() {
    var l = new BufferedMetricsLogger({
        reporter: new reporters.<span class="apidocCodeKeywordSpan">NullReporter</span>()
    });
    l.gauge('test.gauge', 23);
});

it('should have an increment() metric', function() {
    var l = new BufferedMetricsLogger({
        reporter: new reporters.NullReporter()
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>